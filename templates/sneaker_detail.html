<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}} - Sneaker Details</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f8f8;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        .refresh-button {
            position: absolute;
            right: 0;
            top: 0;
            padding: 8px 16px;
            background-color: #0066cc;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .refresh-button:hover {
            background-color: #0052a3;
        }
        .sneaker-title {
            font-size: 28px;
            font-weight: 700;
            margin: 10px 0;
            color: #111;
        }
        .brand-badge {
            display: inline-block;
            padding: 4px 10px;
            background-color: #0066cc;
            color: white;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 15px;
        }
        .main-content {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .image-container {
            flex: 1;
            min-width: 300px;
            text-align: center;
        }
        .sneaker-image {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .details-container {
            flex: 1;
            min-width: 300px;
        }
        .info-box {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .info-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        .info-label {
            font-weight: 500;
            color: #666;
            min-width: 120px;
        }
        .info-value {
            font-weight: 600;
            color: #222;
            flex: 1;
            text-align: right;
        }
        .retail-price {
            color: #0066cc;
            font-size: 18px;
        }
        .marketplace-section {
            margin-top: 30px;
        }
        .marketplace-title {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
            color: #333;
        }
        .marketplace-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .marketplace-table th {
            background-color: #f1f1f1;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 1px solid #ddd;
        }
        .marketplace-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        .marketplace-table tr:last-child td {
            border-bottom: none;
        }
        .marketplace-table tr:hover {
            background-color: #f9f9f9;
        }
        .marketplace-name {
            font-weight: 600;
            color: #333;
        }
        .price {
            font-weight: 600;
            color: #111;
        }
        .profit {
            font-weight: 600;
        }
        .profit.positive {
            color: #28a745;
        }
        .profit.negative {
            color: #dc3545;
        }
        .discount {
            font-weight: 600;
            color: #28a745;
        }
        .visit-btn {
            display: inline-block;
            padding: 8px 15px;
            background-color: #0066cc;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 500;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        .visit-btn:hover {
            background-color: #0052a3;
        }
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-success {
            background-color: #d4edda;
            color: #155724;
        }
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .related-container {
            margin-top: 40px;
        }
        .related-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }
        .related-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        .related-item {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        .related-item:hover {
            transform: translateY(-5px);
        }
        .related-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }
        .related-details {
            padding: 15px;
        }
        .related-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
        .related-price {
            color: #0066cc;
            font-weight: 600;
        }
        .back-link {
            display: inline-block;
            margin-top: 30px;
            color: #0066cc;
            text-decoration: none;
            font-weight: 500;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        .no-data {
            color: #999;
            font-style: italic;
            text-align: center;
            padding: 30px;
        }
        .data-timestamp {
            text-align: center;
            color: #999;
            font-size: 12px;
            margin-top: 40px;
        }
        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* Chart container */
        .chart-container {
            width: 100%;
            height: 300px;
            margin: 20px 0;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-weight: 500;
        }
        .tab.active {
            border-bottom: 2px solid #0066cc;
            color: #0066cc;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
    <script>
        // Function to refresh price data
        function refreshPriceData() {
            document.getElementById('refresh-btn').disabled = true;
            document.getElementById('refresh-spinner').style.display = 'inline-block';
            
            // Redirect to same page with refresh parameter
            window.location.href = '{{refresh_url}}';
        }
        
        // Function to switch tabs
        function switchTab(tabId) {
            // Hide all tabs
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // Deactivate all tab buttons
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // Activate the selected tab
            document.getElementById(tabId).classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
        }
        
        // Function to initialize charts
        function initCharts() {
            if (typeof Chart === 'undefined') return;
            
            // Price comparison chart
            const priceCtx = document.getElementById('priceChart');
            if (priceCtx) {
                const priceData = {
                    labels: [{% for result in price_results %}{% if result.status == 'success' and result.price %}'{{result.site_name}}',{% endif %}{% endfor %}],
                    datasets: [{
                        label: 'Market Price',
                        data: [{% for result in price_results %}{% if result.status == 'success' and result.price %}{{result.price}},{% endif %}{% endfor %}],
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                };
                
                new Chart(priceCtx, {
                    type: 'bar',
                    data: priceData,
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Price ($)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Profit comparison chart
            const profitCtx = document.getElementById('profitChart');
            if (profitCtx) {
                const profitData = {
                    labels: [{% for result in price_results %}{% if result.status == 'success' and result.price %}'{{result.site_name}}',{% endif %}{% endfor %}],
                    datasets: [{
                        label: 'Potential Profit',
                        data: [{% for result in price_results %}{% if result.status == 'success' and result.price %}{{result.profit_potential}},{% endif %}{% endfor %}],
                        backgroundColor: function(context) {
                            const value = context.dataset.data[context.dataIndex];
                            return value >= 0 ? 'rgba(40, 167, 69, 0.2)' : 'rgba(220, 53, 69, 0.2)';
                        },
                        borderColor: function(context) {
                            const value = context.dataset.data[context.dataIndex];
                            return value >= 0 ? 'rgba(40, 167, 69, 1)' : 'rgba(220, 53, 69, 1)';
                        },
                        borderWidth: 1
                    }]
                };
                
                new Chart(profitCtx, {
                    type: 'bar',
                    data: profitData,
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: 'Profit ($)'
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load Chart.js if available
            if (typeof Chart === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
                script.onload = initCharts;
                document.head.appendChild(script);
            } else {
                initCharts();
            }
            
            // Set default active tab
            switchTab('marketplace');
        });
    </script>
</head>
<body>
    <div class="header">
        <button id="refresh-btn" class="refresh-button" onclick="refreshPriceData()">
            <span id="refresh-spinner" class="spinner" style="display: none;"></span>
            Refresh Price Data
        </button>
        <div class="sneaker-title">{{title}}</div>
        <div class="brand-badge">{{brand}}</div>
    </div>
    
    <div class="main-content">
        <div class="image-container">
            {% if image_url %}
            <img src="{{image_url}}" alt="{{title}}" class="sneaker-image">
            {% else %}
            <div class="no-data">No image available</div>
            {% endif %}
        </div>
        
        <div class="details-container">
            <div class="info-box">
                <div class="info-title">Sneaker Details</div>
                
                <div class="info-row">
                    <div class="info-label">Brand:</div>
                    <div class="info-value">{{brand}}</div>
                </div>
                
                <div class="info-row">
                    <div class="info-label">SKU:</div>
                    <div class="info-value">{{sku}}</div>
                </div>
                
                <div class="info-row">
                    <div class="info-label">Release Date:</div>
                    <div class="info-value">{{release_date}}</div>
                </div>
                
                <div class="info-row">
                    <div class="info-label">Retail Price:</div>
                    <div class="info-value retail-price">${{retail_price|floatformat:2}}</div>
                </div>
                
                {% if colorway %}
                <div class="info-row">
                    <div class="info-label">Colorway:</div>
                    <div class="info-value">{{colorway}}</div>
                </div>
                {% endif %}
                
                {% if best_price %}
                <div class="info-row">
                    <div class="info-label">Best Market Price:</div>
                    <div class="info-value">${{best_price.price|floatformat:2}} ({{best_price.site}})</div>
                </div>
                {% endif %}
                
                {% if price_range %}
                <div class="info-row">
                    <div class="info-label">Price Range:</div>
                    <div class="info-value">${{price_range|floatformat:2}}</div>
                </div>
                {% endif %}
                
                {% if best_profit and best_profit.amount > 0 %}
                <div class="info-row">
                    <div class="info-label">Best Profit:</div>
                    <div class="info-value profit positive">${{best_profit.amount|floatformat:2}} ({{best_profit.site}})</div>
                </div>
                {% endif %}
            </div>
            
            <div class="info-box">
                <div class="info-title">Source Information</div>
                
                <div class="info-row">
                    <div class="info-label">Source:</div>
                    <div class="info-value">{{source}}</div>
                </div>
                
                <div class="info-row">
                    <div class="info-label">Original Link:</div>
                    <div class="info-value">
                        <a href="{{source_url}}" target="_blank" class="visit-btn">View on {{source}}</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tabs">
        <div id="tab-marketplace" class="tab active" onclick="switchTab('marketplace')">Marketplace Comparison</div>
        <div id="tab-charts" class="tab" onclick="switchTab('charts')">Price Charts</div>
        {% if purchase_links %}
        <div id="tab-retailers" class="tab" onclick="switchTab('retailers')">Retailers</div>
        {% endif %}
    </div>
    
    <div id="marketplace" class="tab-content active">
        {% if price_results %}
        <table class="marketplace-table">
            <thead>
                <tr>
                    <th>Marketplace</th>
                    <th>Price</th>
                    <th>Difference</th>
                    <th>Profit</th>
                    <th>ROI</th>
                    <th>Link</th>
                </tr>
            </thead>
            <tbody>
                {% for result in price_results %}
                <tr>
                    <td class="marketplace-name">{{result.site_name}}</td>
                    
                    {% if result.status == 'success' and result.price %}
                    <td class="price">${{result.price|floatformat:2}}</td>
                    
                    <td>
                        {% if result.price_difference > 0 %}
                        <span class="profit positive">+${{result.price_difference|floatformat:2}}</span>
                        {% else %}
                        <span class="profit negative">${{result.price_difference|floatformat:2}}</span>
                        {% endif %}
                    </td>
                    
                    <td>
                        {% if result.profit_potential > 0 %}
                        <span class="profit positive">+${{result.profit_potential|floatformat:2}}</span>
                        {% else %}
                        <span class="profit negative">${{result.profit_potential|floatformat:2}}</span>
                        {% endif %}
                    </td>
                    
                    <td>
                        {% if result.percentage_difference > 0 %}
                        <span class="discount">+{{result.percentage_difference|floatformat:1}}%</span>
                        {% else %}
                        <span class="profit negative">{{result.percentage_difference|floatformat:1}}%</span>
                        {% endif %}
                    </td>
                    
                    <td>
                        {% if result.url %}
                        <a href="{{result.url}}" target="_blank" class="visit-btn">Visit</a>
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    
                    {% else %}
                    <td colspan="5" class="no-data">
                        <span class="status-badge status-error">{{result.status}}</span>
                        No price data available
                    </td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="no-data">No marketplace data available</div>
        {% endif %}
    </div>
    
    <div id="charts" class="tab-content">
        {% if price_results %}
        <div class="chart-container">
            <canvas id="priceChart"></canvas>
        </div>
        
        <div class="chart-container">
            <canvas id="profitChart"></canvas>
        </div>
        {% else %}
        <div class="no-data">No data available for charts</div>
        {% endif %}
    </div>
    
    {% if purchase_links %}
    <div id="retailers" class="tab-content">
        <table class="marketplace-table">
            <thead>
                <tr>
                    <th>Retailer</th>
                    <th>Status</th>
                    <th>Price</th>
                    <th>Discount</th>
                    <th>Link</th>
                </tr>
            </thead>
            <tbody>
                {% for link in purchase_links %}
                <tr>
                    <td class="marketplace-name">{{link.retailer}}</td>
                    <td>
                        {% if link.status == 'available' %}
                        <span class="status-badge status-success">Available</span>
                        {% else %}
                        <span class="status-badge status-error">{{link.status|title}}</span>
                        {% endif %}
                    </td>
                    <td class="price">
                        {% if link.price %}
                        ${{link.price|floatformat:2}}
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td>
                        {% if link.discount %}
                        <span class="discount">{{link.discount}}% OFF</span>
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{link.url}}" target="_blank" class="visit-btn">Visit</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
    
    <div class="data-timestamp">
        Data last updated: {{timestamp}}
    </div>
    
    <a href="javascript:history.back()" class="back-link">← Back to Results</a>
</body>
</html>
